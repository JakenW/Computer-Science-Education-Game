<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Making a Nonogram Puzzle</title>
<link rel="stylesheet" href="{{url_for('static', filename='puzzle.css')}}">
</head>
<body>
<!-- Navigation Bar -->
<div class="topnav">
    <ul>
      <a class="active" href="http://127.0.0.1:5000/">HOME</a>
      <a href="http://127.0.0.1:5000/register">REGISTER</a>
      <a href="http://127.0.0.1:5000/login">LOGIN</a>
	  <a href="http://127.0.0.1:5000/createquestion">CREATE QUESTION</a>
     <a href="http://127.0.0.1:5000/play">GAME</a>
    <li class="dropdown">
      <a href="javascript:void(0)" class="dropbtn">PUZZLE</a>
      <div class="dropdown-content">
        <a href="http://127.0.0.1:5000/puzzles">Puzzle Library</a>
        <a href="http://127.0.0.1:5000/createpuzzle">Create a Puzzle</a>
      </div>
    </li>
    </ul>
</div>

	<h1 id="headline">Create a Nonogram Puzzle</h1>
    <center><article>
        <button id="reveal" class="instr-label" onClick="toggleInstructions()">Instructions</a>
    </article></center>

    <div id="puzzle-full" >
        <section class="topkey">
            <div id="c0r0"></div>
            <div id="c1r0"></div>
            <div id="c2r0"></div>
            <div id="c3r0"></div>
            <div id="c4r0"></div>
            <div id="c5r0"></div>
            <div id="c6r0"></div>
            <div id="c7r0"></div>
            <div id="c8r0"></div>
            <div id="c9r0"></div>
            <div id="c10r0"></div>
        </section>
        <section id="puzzleboard">
            <div class="leftkey" id="c0r1"></div>
            <div id="c1r1"></div>
            <div id="c2r1"></div>
            <div id="c3r1"></div>
            <div id="c4r1"></div>
            <div id="c5r1"></div>
            <div id="c6r1"></div>
            <div id="c7r1"></div>
            <div id="c8r1"></div>
            <div id="c9r1"></div>
            <div id="c10r1"></div>

            <div class="leftkey" id="c0r2"></div>
            <div id="c1r2"></div>
            <div id="c2r2"></div>
            <div id="c3r2"></div>
            <div id="c4r2"></div>
            <div id="c5r2"></div>
            <div id="c6r2"></div>
            <div id="c7r2"></div>
            <div id="c8r2"></div>
            <div id="c9r2"></div>
            <div id="c10r2"></div>

            <div class="leftkey" id="c0r3"></div>
            <div id="c1r3"></div>
            <div id="c2r3"></div>
            <div id="c3r3"></div>
            <div id="c4r3"></div>
            <div id="c5r3"></div>
            <div id="c6r3"></div>
            <div id="c7r3"></div>
            <div id="c8r3"></div>
            <div id="c9r3"></div>
            <div id="c10r3"></div>

            <div class="leftkey" id="c0r4"></div>
            <div id="c1r4"></div>
            <div id="c2r4"></div>
            <div id="c3r4"></div>
            <div id="c4r4"></div>
            <div id="c5r4"></div>
            <div id="c6r4"></div>
            <div id="c7r4"></div>
            <div id="c8r4"></div>
            <div id="c9r4"></div>
            <div id="c10r4"></div>

            <div class="leftkey" id="c0r5"></div>
            <div id="c1r5"></div>
            <div id="c2r5"></div>
            <div id="c3r5"></div>
            <div id="c4r5"></div>
            <div id="c5r5"></div>
            <div id="c6r5"></div>
            <div id="c7r5"></div>
            <div id="c8r5"></div>
            <div id="c9r5"></div>
            <div id="c10r5"></div>

            <div class="leftkey" id="c0r6"></div>
            <div id="c1r6"></div>
            <div id="c2r6"></div>
            <div id="c3r6"></div>
            <div id="c4r6"></div>
            <div id="c5r6"></div>
            <div id="c6r6"></div>
            <div id="c7r6"></div>
            <div id="c8r6"></div>
            <div id="c9r6"></div>
            <div id="c10r6"></div>

            <div class="leftkey" id="c0r7"></div>
            <div id="c1r7"></div>
            <div id="c2r7"></div>
            <div id="c3r7"></div>
            <div id="c4r7"></div>
            <div id="c5r7"></div>
            <div id="c6r7"></div>
            <div id="c7r7"></div>
            <div id="c8r7"></div>
            <div id="c9r7"></div>
            <div id="c10r7"></div>

            <div class="leftkey" id="c0r8"></div>
            <div id="c1r8"></div>
            <div id="c2r8"></div>
            <div id="c3r8"></div>
            <div id="c4r8"></div>
            <div id="c5r8"></div>
            <div id="c6r8"></div>
            <div id="c7r8"></div>
            <div id="c8r8"></div>
            <div id="c9r8"></div>
            <div id="c10r8"></div>

            <div class="leftkey" id="c0r9"></div>
            <div id="c1r9"></div>
            <div id="c2r9"></div>
            <div id="c3r9"></div>
            <div id="c4r9"></div>
            <div id="c5r9"></div>
            <div id="c6r9"></div>
            <div id="c7r9"></div>
            <div id="c8r9"></div>
            <div id="c9r9"></div>
            <div id="c10r9"></div>

            <div class="leftkey" id="c0r10"></div>
            <div id="c1r10"></div>
            <div id="c2r10"></div>
            <div id="c3r10"></div>
            <div id="c4r10"></div>
            <div id="c5r10"></div>
            <div id="c6r10"></div>
            <div id="c7r10"></div>
            <div id="c8r10"></div>
            <div id="c9r10"></div>
            <div id="c10r10"></div>
        </section>
    </div>
    <div id="instructions">
        <p id="instructions-text">
        Click the cells at the spots which you would
		like to be part of the solution.
		<br>
		<br>
		If you would like to start over, press the
		restart button below the grid.
		<br>
		<br>
		When you are satisfied with your created puzzle, 
		submit using the button below the grid. 
		<br>
		<br>
		Have fun!
        </p>
    </div>
    <br>
    <center><article>
		<button id="restart" onClick="cleanBoard()">Restart</button>
	</article></center>
	
	<center>
	<form id="puzzleform" action="createpuzzle" method="post">
		<input type="hidden" name="usrpzl" id="usrpzl" value="">
		<button type="submit">Submit</button>
	</form>
	</center>
</body>
</html>

<script>
/*----- app's state variables -----*/
var board;

/*----- cached element references -----*/
var cells = document.querySelectorAll('div');
var headline = document.getElementById('headline');
var puzzleBoard = document.getElementById('puzzleboard');
var restartButton = document.getElementById('restart');
var fullPuzzle = document.getElementById('puzzle-full');
var fullInstructions = document.getElementById('instructions');

/*----- event listeners -----*/
puzzleBoard.addEventListener('click', handleClick);
restartButton.addEventListener('click', cleanBoard);

/*----- functions -----*/
initialize();

// Swap gameboard for instructions on click 
function toggleInstructions() {
    if (!fullPuzzle.style.display) {
        fullPuzzle.style.display = 'none';
        fullInstructions.style.display = 'block'
    } else if (fullPuzzle.style.display == 'none') {
        fullPuzzle.style.display = 'block';
        fullInstructions.style.display = 'none'
    } else if (fullPuzzle.style.display == 'block') {
        fullPuzzle.style.display = 'none';
        fullInstructions.style.display = 'block'
    }
}

// Make all cells white on restart
function cleanBoard() {
    initialize()
    cells.forEach(function (el) {el.style.backgroundColor = ''})
    headline.innerHTML = 'Create a Nonogram Puzzle';
}

// Make tiles toggle white/black AND toggle cell value 0/1
function handleClick(evt) {
    const marker = evt.target;
    var markerString = marker.id;
    var rowArr = markerString.split('r');
    var rowIdx = rowArr[rowArr.length - 1];
    rowArr.pop();
    var colIdx = rowArr.join('').replace('c', '');
    if (colIdx != 0) {
        if (evt.altKey === false) {
            if (!marker.style.backgroundColor) {
                marker.style.backgroundColor = 'grey'
                board[rowIdx][colIdx] = 1;
            } else if (marker.style.backgroundColor = 'grey') {
                marker.style.backgroundColor = ''
                board[rowIdx][colIdx] = 0;
            } 
        } 
    }
	//console.log(board);
}

// Initialize board
function initialize() {
    board = [
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], // column 
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], // column 1
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], // column 2
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], // column 3
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], // column 4
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], // column 5
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], // column 6
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], // column 7
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], // column 8
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], // column 9
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]  // column 10
    ];
}

/*
Function to send the user's specified game board
to the Flask backend when the button using the function
is clicked.
*/
var form = document.getElementById("puzzleform")
var input = document.getElementById("usrpzl")
form.addEventListener("submit", function(e) {
	input.value = board;
	console.log(input.value)
	form.submit()
})

</script>